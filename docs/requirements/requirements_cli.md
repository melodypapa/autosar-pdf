# CLI Requirements

This document contains all software requirements for the autosar-pdf2txt command-line interface.

## Maturity Levels

Each requirement has a maturity level that indicates its status:

- **draft**: Newly created requirement, under review, or not yet implemented
- **accept**: Accepted requirement, implemented in the codebase
- **invalid**: Deprecated requirement, superseded, or no longer applicable

---

### SWR_CLI_00001
**Title**: CLI Entry Point

**Maturity**: accept

**Description**: The system shall provide a command-line interface tool named `autosar-extract` for extracting AUTOSAR models from PDF files.

---

### SWR_CLI_00002
**Title**: CLI File Input Support

**Maturity**: accept

**Description**: The CLI shall accept one or more PDF file paths as input arguments.

---

### SWR_CLI_00003
**Title**: CLI Directory Input Support

**Maturity**: accept

**Description**: The CLI shall accept directory paths as input and automatically discover all PDF files within them (sorted alphabetically).

---

### SWR_CLI_00004
**Title**: CLI Output File Option

**Maturity**: accept

**Description**: The CLI shall support an `-o` / `--output` option to write the extracted markdown to a specified file instead of stdout.

---

### SWR_CLI_00005
**Title**: CLI Verbose Mode

**Maturity**: accept

**Description**: The CLI shall support a `-v` / `--verbose` option to enable verbose output mode, which prints detailed debug information during processing.

---

### SWR_CLI_00006
**Title**: CLI Input Validation

**Maturity**: accept

**Description**: The CLI shall validate input paths and provide appropriate error messages for:
- Non-existent paths
- Non-PDF files (with warning)
- Empty directories (with warning)
- No valid PDF files to process (with error)

---

### SWR_CLI_00007
**Title**: CLI Progress Feedback

**Maturity**: accept

**Description**: The CLI shall provide progress feedback via stderr messages indicating:
- Number of PDF files being processed
- Total number of top-level packages found
- Total number of root classes found
- Package names in verbose mode
- Output file location when applicable

**Implementation Note**: The CLI uses `parse_pdfs()` to parse all PDF files at once, then resolves parent/children relationships on the complete model. This ensures correct hierarchy representation across all PDFs regardless of parse order.

---

### SWR_CLI_00008
**Title**: CLI Logging

**Maturity**: accept

**Description**: The CLI shall provide logging information to show the current processing progress, including detailed status messages for each operation step.

---

### SWR_CLI_00009
**Title**: CLI Error Handling

**Maturity**: accept

**Description**: The CLI shall catch and report exceptions with user-friendly error messages via stderr and return appropriate exit codes (0 for success, 1 for error).

---

### SWR_CLI_00010
**Title**: CLI Class File Output

**Maturity**: accept

**Description**: When the `--include-class-details` flag is specified along with the `-o` / `--output` option, the CLI shall create separate markdown files for each AUTOSAR class in a directory structure that mirrors the package hierarchy. The root directory for the class files shall be the same as the output markdown file location.

---

### SWR_CLI_00011
**Title**: CLI Class Files Flag

**Maturity**: accept

**Description**: The CLI shall support a `--include-class-details` flag to enable creation of separate markdown files for each class. This flag only has effect when used with the `-o` / `--output` option. When not specified, only the main hierarchy output file is created.

---

### SWR_CLI_00012
**Title**: CLI Class Hierarchy Flag

**Maturity**: accept

**Description**: The CLI shall support a `--include-class-hierarchy` flag to enable generation of class inheritance hierarchy in a separate markdown file. When this flag is specified along with the `-o` / `--output` option, the system shall:
- Collect all classes from parsed packages
- Generate a class hierarchy section showing inheritance relationships from root classes
- Write the class hierarchy to a separate markdown file named `<package_name>_hierarchy.md` (with hyphens replaced by underscores)
- Not modify the main package hierarchy output file

The separate hierarchy file shall be created in the same directory as the main output file, with the filename generated by replacing hyphens with underscores in the output file stem and appending "_hierarchy" before the file extension.

**Example**: If the output file is `autosar-models.md`, the hierarchy file will be named `autosar_models_hierarchy.md`.

---

### SWR_CLI_00013
**Title**: CLI Table Extraction

**Maturity**: accept

**Description**: The system shall provide a command-line interface tool named `autosar-extract-table` for extracting AUTOSAR-related tables from PDF files and saving them as images.

The CLI shall support the following features:

**Input Support**:
- Accept one or more PDF file paths or directory paths as input arguments
- When a directory is provided, automatically discover all PDF files within it (sorted alphabetically)
- Validate input paths and provide appropriate error messages for non-existent paths, non-PDF files (with warning), empty directories (with warning), and no valid PDF files to process (with error)

**Output Configuration**:
- Require an `-o` / `--output` option to specify the output directory path for extracted table images
- Create the output directory if it does not exist
- Extract only AUTOSAR-related tables from PDF files and save each table as a separate PNG image file
- A table is considered AUTOSAR-related if its header contains both "Class" and "Package" fields (case-insensitive)
- Crop each image to the bounding box of the table to remove surrounding page content
- Name each image file with the format `table_page{page_number}_table{table_number}.png` where:
  - `{page_number}` is the PDF page number where the table was found
  - `{table_number}` is the sequential table number on that page

**Table Filtering**:
- Analyze the first row (header) of each extracted table
- Normalize header values by converting to lowercase and stripping whitespace
- Check if the header contains both "class" and "package" keywords
- Only extract and save tables that meet the AUTOSAR-related criteria
- Skip tables that do not contain both required fields
- Log skipped tables in debug mode when verbose output is enabled

**Logging and Feedback**:
- Provide progress feedback via messages indicating the number of PDF files being processed, output directory location, number of tables extracted from each PDF file, and total number of tables extracted across all PDF files
- Support a `-v` / `--verbose` option to enable verbose output mode, which prints detailed debug information during processing including the number of tables found on each page and which tables were skipped
- Suppress pdfminer warnings about invalid color values in PDF files
- Provide logging information to show the current processing progress, including detailed status messages for each operation step

**Error Handling**:
- Catch and report exceptions with user-friendly error messages
- Return appropriate exit codes (0 for success, 1 for error)
- Display detailed error tracebacks when verbose mode is enabled

---

### SWR_CLI_00014
**Title**: CLI Logger File Specification

**Maturity**: draft

**Description**: The CLI shall support a `--log-file` option to specify a file path for writing log messages. When this option is provided, all log messages shall be written to the specified log file in addition to the standard output (stderr).

The CLI shall:
- Accept a file path as the argument to `--log-file`
- Create the log file if it does not exist
- Create parent directories if they do not exist
- Write all log messages to the specified log file with the same format and log level as console output
- Continue to output log messages to stderr (not redirect, but duplicate to the log file)
- Support the `--log-file` option independently of the `-v` / `--verbose` flag
- Apply the log level determined by the `-v` / `--verbose` flag to both console and file output
- Include timestamps in the log file for each log message to facilitate debugging and analysis

**Log File Format**:
- Each log entry shall include: timestamp, log level, and message
- Timestamp format: `YYYY-MM-DD HH:MM:SS,mmm` (milliseconds included)
- Example: `2026-01-25 14:30:45,123 INFO: Parsing 5 PDF file(s)...`

**Usage Example**:
```bash
# Write logs to a file while also displaying on console
autosar-extract input.pdf -o output.md --log-file extraction.log

# Combine with verbose mode for detailed logging to file
autosar-extract input.pdf -o output.md --log-file extraction.log -v

# Write logs to a file in a specific directory (directory will be created if needed)
autosar-extract input.pdf -o output.md --log-file logs/extraction.log
```

**Error Handling**:
- If the specified log file path is invalid or cannot be created, log an error message to stderr and continue with console-only logging
- If the log file cannot be written to during execution, log an error message to stderr and continue with console-only logging
- Do not fail the entire operation if log file writing fails

**Rationale**:
- Log files provide a persistent record of processing operations for debugging and auditing
- Timestamps enable analysis of processing time and identification of performance issues
- Writing to both console and file ensures users see progress in real-time while maintaining a permanent record
- Independent support for `--log-file` and `-v` allows flexible logging configuration